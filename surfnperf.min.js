/*!
 * @license
 * Copyright 2015-2020 Comcast Cable Communications Management, LLC
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(a,b){"function"==typeof define&&define.amd?define("surfnperf",b):"object"==typeof exports?module.exports=b():a.surfnperf=b()}(this,function(){Date.now||(Date.now=function(){return(new Date).getTime()});var a=function(a,b){for(var c in b)a.hasOwnProperty(c)||(a[c]=b[c])},b=function(a,b){if(Array.prototype.indexOf)return-1!=a.indexOf(b);var c,d=a.length;for(c=0;c<d;c++)if(a[c]===b)return!0;return!1},c=function(){this._data={custom:{},marks:{},highResMarks:{},events:{}},this._navigationTiming=null,this._highResTime=null,this._userTiming=null,this._navigationTimingEvents={a:["navigationStart","unloadEventEnd","unloadEventStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","domLoading"],b:["domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"]},this.initialize()},d=c.prototype;return d._setPerformanceApis=function(){window.performance?(this._navigationTiming=!!window.performance.timing,this._highResTime=!!window.performance.now,this._userTiming=!!(window.performance.mark&&window.performance.measure&&window.performance.getEntriesByName)):(this._navigationTiming=!1,this._highResTime=!1,this._userTiming=!1)},d._setPerfProperties=function(){window.SURF_N_PERF&&window.SURF_N_PERF.marks||(window.SURF_N_PERF={marks:{},highResMarks:{}})},d._setInitialUrl=function(){this.setCustom("initialUrl",window.location.pathname)},d.initialize=function(){this._setPerformanceApis(),this._setPerfProperties(),this._setInitialUrl()},d.now=function(a){return a=a||"highRes",this._highResTime&&"highRes"===a?window.performance.now():Date.now()},d.performanceTiming=function(){return this._navigationTiming?window.performance.timing:{}},d._performanceTimingL2=function(a){var b=this.getTimingMark("loadEventEnd","DOM")-this.getTimingMark(a,"DOM"),c=window.SURF_N_PERF.highResMarks.loadEventEnd-b;return c<0?0:this._round(c,{decimalPlaces:10})},d.getTimingMark=function(a,c){return c=c||"DOM",this._navigationTiming?"DOM"===c||!1===this._highResTime?this.performanceTiming()[a]:this._performanceTimingL2(a):b(this._navigationTimingEvents.a,a)?this.getMark("pageStart","DOM"):this.getMark("loadEventEnd","DOM")},d.userTiming=function(){return this._userTiming?window.performance:{}},d.mark=function(a){this._highResTime&&(this._data.highResMarks[a]=this.now()),this._userTiming&&this.userTiming().mark(a),this._data.marks[a]=this.now("DOM")},d.getMark=function(a,b){var c;return b=b||"highRes","highRes"===b&&!0===this._highResTime&&(c=this._data.highResMarks[a]||window.SURF_N_PERF.highResMarks[a]),c||this._data.marks[a]||window.SURF_N_PERF.marks[a]},d.clearMarks=function(a){var b=window.SURF_N_PERF.highResMarks.loadEventEnd,c=window.SURF_N_PERF.marks.loadEventEnd;this._userTiming&&this.userTiming().clearMarks(a),a?"loadEventEnd"!==a&&(delete this._data.highResMarks[a],delete this._data.marks[a],delete window.SURF_N_PERF.highResMarks[a],delete window.SURF_N_PERF.marks[a]):(this._data.highResMarks={},this._data.marks={},window.SURF_N_PERF.highResMarks=b?{loadEventEnd:b}:{},window.SURF_N_PERF.marks=c?{loadEventEnd:c}:{})},d._isTimingMark=function(a){return b(this._navigationTimingEvents.a.concat(this._navigationTimingEvents.b),a)},d._getDurationMark=function(a){return this._isTimingMark(a)?this.getTimingMark(a,"highRes"):this.getMark(a)},d._round=function(a,b){b=b||{};var c=b.decimalPlaces||0;return a=+a,a.toFixed?+a.toFixed(c):a},d._roundedDuration=function(a,b,c){return this._round(b-a,c)},d._measureName=function(a,b){return"_SNP_"+a+"_TO_"+b},d._setMeasure=function(a,b){try{this.userTiming().measure(this._measureName(a,b),a,b)}catch(c){window.console&&window.console.error&&(c&&c.message?console.error("Surf-N-Perf Exception:",c.message):console.error("Surf-N-Perf Exception: at least one of these events/marks is not available yet",a,b))}},d._getMeasureDuration=function(a,b){return(this.userTiming().getEntriesByName(this._measureName(a,b))[0]||{}).duration},d.markNow=function(){var a="_NOW_"+this.now("DOM");return this.mark(a),a},d.duration=function(a,b,c){return b=b||this.markNow(),this._userTiming?(this._setMeasure(a,b),this._round(this._getMeasureDuration(a,b),c)):this._highResTime&&"navigationStart"===a&&!this._isTimingMark(b)?this._round(this.getMark(b),c):this._roundedDuration(this._getDurationMark(a),this._getDurationMark(b),c)},d.updateEvent=function(b,c,d){var e={};e[b]={},a(this._data.events,e),this._data.events[b][c]=d},d.resetEvent=function(a,b,c){this._data.events[a]={},this._data.events[a][b]=c},d.eventStart=function(a){this.resetEvent(a,"start",this.now())},d.eventEnd=function(a,b){var c,d=this.now();b=b||{};for(c in b)this.updateEvent(a,c,b[c]);this.updateEvent(a,"end",d)},d.getEventData=function(a,b){var c=this._data.events[a];if(c)return c[b]},d.eventDuration=function(a,b){return this._roundedDuration(this.getEventData(a,"start"),this.getEventData(a,"end"),b)},d.setCustom=function(a,b){this._data.custom[a]=b},d.getCustom=function(a){return this._data.custom[a]},d.getNetworkTime=function(){return this.duration("fetchStart","connectEnd")},d.getServerTime=function(){return this.duration("requestStart","responseEnd")},d.getNetworkLatency=function(){return this.duration("fetchStart","responseEnd")},d.getProcessingLoadTime=function(){return this.duration("responseEnd","loadEventEnd")},d.getFullRequestLoadTime=function(){return this.duration("navigationStart","loadEventEnd")},d.getFirstPaint=function(a){if(this._supportsPaintAPI()){var b=window.performance.getEntriesByName("first-paint")[0]||{};return this._roundedDuration(this.getTimingMark("navigationStart","DOM"),b.startTime,a)}return this.msFirstPaint()?this._roundedDuration(this.getTimingMark("navigationStart","DOM"),this.msFirstPaint(),a):null},d._supportsRequestAnimationFrame=function(){return!!window.requestAnimationFrame},d.getFirstPaintFrame=function(a){return this._supportsRequestAnimationFrame()?this.duration("navigationStart","firstPaintFrame",a):null},d._supportsPaintAPI=function(){return window.performance&&window.performance.getEntriesByName&&"PerformancePaintTiming"in window},d.msFirstPaint=function(){return window.performance&&window.performance.timing&&window.performance.timing.msFirstPaint?window.performance.timing.msFirstPaint:void 0},d.isHidden=function(){return SURF_N_PERF.visibility&&SURF_N_PERF.visibility.hiddenProperty?document[SURF_N_PERF.visibility.hiddenProperty]:null},d.getHiddenTime=function(a){var b,c,d=0,e=[],f=function(a){return 0===a?"navigationStart":"visibility"+(a-1)};if(SURF_N_PERF.visibility&&SURF_N_PERF.visibility.initialState&&SURF_N_PERF.visibility.stateUpdates){for(e=e.concat(SURF_N_PERF.visibility.initialState,SURF_N_PERF.visibility.stateUpdates),c=e.length,b=1;b<c;b++)"visible"!==e[b-1]&&"visible"===e[b]&&(d+=this.duration(f(b-1),f(b),{decimalPlaces:10}));return"visible"!==e[c-1]&&(d+=this.duration(f(c-1),null,{decimalPlaces:10})),this._round(d,a)}return null},new c});