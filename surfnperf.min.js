/*!
 * Copyright 2014 Comcast Cable Communications Management, LLC
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(a,b){"function"==typeof define&&define.amd?define("surfnperf",b):a.surfnperf=b()}(this,function(){Date.now||(Date.now=function(){return(new Date).getTime()});var a=function(a,b){for(var c in b)a.hasOwnProperty(c)||(a[c]=b[c])},b=function(){this._data={custom:{},marks:{},highResMarks:{},events:{}},this._navigationTiming=null,this._highResTime=null,this._userTiming=null,this._navigationTimingEvents={a:["navigationStart","unloadEventEnd","unloadEventStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","domLoading"],b:["domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"]},this.initialize()};return b.prototype._setPerformanceApis=function(){window.performance?(this._navigationTiming=!!window.performance.timing,this._highResTime=!!window.performance.now,this._userTiming=!!(window.performance.mark&&window.performance.measure&&window.performance.getEntriesByName)):(this._navigationTiming=!1,this._highResTime=!1,this._userTiming=!1)},b.prototype._setPerfProperties=function(){window.SURF_N_PERF&&window.SURF_N_PERF.marks||(window.SURF_N_PERF={marks:{},highResMarks:{}})},b.prototype._setInitialUrl=function(){this.setCustom("initialUrl",window.location.pathname)},b.prototype.initialize=function(){this._setPerformanceApis(),this._setPerfProperties(),this._setInitialUrl()},b.prototype.now=function(a){return a=a||"highRes",this._highResTime&&"highRes"===a?window.performance.now():Date.now()},b.prototype.performanceTiming=function(){return this._navigationTiming?window.performance.timing:{}},b.prototype._performanceTimingL2=function(a){var b=this.getTimingMark("loadEventEnd","DOM")-this.getTimingMark(a,"DOM"),c=window.SURF_N_PERF.highResMarks.loadEventEnd-b;return 0>c?0:this._round(c,{decimalPlaces:10})},b.prototype.getTimingMark=function(a,b){return b=b||"DOM",this._navigationTiming?"DOM"===b||this._highResTime===!1?this.performanceTiming()[a]:this._performanceTimingL2(a):this._navigationTimingEvents.a.indexOf(a)>-1?this.getMark("pageStart","DOM"):this.getMark("loadEventEnd","DOM")},b.prototype.userTiming=function(){return this._userTiming?window.performance:{}},b.prototype.mark=function(a){this._highResTime&&(this._data.highResMarks[a]=this.now()),this._userTiming&&this.userTiming().mark(a),this._data.marks[a]=this.now("DOM")},b.prototype.getMark=function(a,b){var c;return b=b||"highRes","highRes"===b&&this._highResTime===!0&&(c=this._data.highResMarks[a]||window.SURF_N_PERF.highResMarks[a]),c||this._data.marks[a]||window.SURF_N_PERF.marks[a]},b.prototype._isTimingMark=function(a){return this._navigationTimingEvents.a.concat(this._navigationTimingEvents.b).indexOf(a)>-1},b.prototype._getDurationMark=function(a){return this._isTimingMark(a)?this.getTimingMark(a,"highRes"):this.getMark(a)},b.prototype._round=function(a,b){b=b||{};var c=b.decimalPlaces||0;return+a.toFixed(c)},b.prototype._roundedDuration=function(a,b,c){return this._round(b-a,c)},b.prototype._measureName=function(a,b){return"_SNP_"+a+"_TO_"+b},b.prototype._setMeasure=function(a,b){this.userTiming().measure(this._measureName(a,b),a,b)},b.prototype._getMeasureDuration=function(a,b){var c=this.userTiming().getEntriesByName(this._measureName(a,b))[0]||{};return c.duration},b.prototype.duration=function(a,b,c){return this._userTiming?(this._setMeasure(a,b),this._round(this._getMeasureDuration(a,b),c)):this._roundedDuration(this._getDurationMark(a),this._getDurationMark(b),c)},b.prototype.updateEvent=function(b,c,d){var e={};e[b]={},a(this._data.events,e),this._data.events[b][c]=d},b.prototype.resetEvent=function(a,b,c){this._data.events[a]={},this._data.events[a][b]=c},b.prototype.eventStart=function(a){this.resetEvent(a,"start",this.now())},b.prototype.eventEnd=function(a,b){var c,d=this.now();b=b||{};for(c in b)this.updateEvent(a,c,b[c]);this.updateEvent(a,"end",d)},b.prototype.getEventData=function(a,b){var c=this._data.events[a];return c?c[b]:void 0},b.prototype.eventDuration=function(a,b){return this._roundedDuration(this.getEventData(a,"start"),this.getEventData(a,"end"),b)},b.prototype.setCustom=function(a,b){this._data.custom[a]=b},b.prototype.getCustom=function(a){return this._data.custom[a]},b.prototype.getNetworkTime=function(){return this.duration("fetchStart","connectEnd")},b.prototype.getServerTime=function(){return this.duration("requestStart","responseEnd")},b.prototype.getNetworkLatency=function(){return this.duration("fetchStart","responseEnd")},b.prototype.getProcessingLoadTime=function(){return this.duration("responseEnd","loadEventEnd")},b.prototype.getFullRequestLoadTime=function(){return this.duration("navigationStart","loadEventEnd")},new b});