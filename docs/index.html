<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Surf-N-Perf</title>
    
    <meta name="description" content="A micro-library for gathering web page performance data" />
    
        <meta name="keywords" content="performance" />
        <meta name="keyword" content="performance" />
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"Surf-N-Perf","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"Surf-N-Perf","description":"A micro-library for gathering web page performance data","keyword":"performance"},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Surf-N-Perf</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="SurfNPerf">
            <span class="title">
                <a href="SurfNPerf.html">SurfNPerf</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="SurfNPerf.SNPProto.clearMarks"><a href="SurfNPerf.html#.SNPProto.clearMarks">SNPProto.clearMarks</a></li>
            
                <li data-name="SurfNPerf.SNPProto.duration"><a href="SurfNPerf.html#.SNPProto.duration">SNPProto.duration</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getFirstContentfulPaint"><a href="SurfNPerf.html#.SNPProto.getFirstContentfulPaint">SNPProto.getFirstContentfulPaint</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getFirstPaint"><a href="SurfNPerf.html#.SNPProto.getFirstPaint">SNPProto.getFirstPaint</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getFirstPaintFrame"><a href="SurfNPerf.html#.SNPProto.getFirstPaintFrame">SNPProto.getFirstPaintFrame</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getFullRequestLoadTime"><a href="SurfNPerf.html#.SNPProto.getFullRequestLoadTime">SNPProto.getFullRequestLoadTime</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getHiddenTime"><a href="SurfNPerf.html#.SNPProto.getHiddenTime">SNPProto.getHiddenTime</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getNetworkLatency"><a href="SurfNPerf.html#.SNPProto.getNetworkLatency">SNPProto.getNetworkLatency</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getNetworkTime"><a href="SurfNPerf.html#.SNPProto.getNetworkTime">SNPProto.getNetworkTime</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getProcessingLoadTime"><a href="SurfNPerf.html#.SNPProto.getProcessingLoadTime">SNPProto.getProcessingLoadTime</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getServerTime"><a href="SurfNPerf.html#.SNPProto.getServerTime">SNPProto.getServerTime</a></li>
            
                <li data-name="SurfNPerf.SNPProto.getTimingMark"><a href="SurfNPerf.html#.SNPProto.getTimingMark">SNPProto.getTimingMark</a></li>
            
                <li data-name="SurfNPerf.SNPProto.isHidden"><a href="SurfNPerf.html#.SNPProto.isHidden">SNPProto.isHidden</a></li>
            
                <li data-name="SurfNPerf.SNPProto.markNow"><a href="SurfNPerf.html#.SNPProto.markNow">SNPProto.markNow</a></li>
            
                <li data-name="SurfNPerf.SNPProto.now"><a href="SurfNPerf.html#.SNPProto.now">SNPProto.now</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="SurfNPerfRT">
            <span class="title">
                <a href="SurfNPerfRT.html">SurfNPerfRT</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="SurfNPerfRT.SNPRTProto.duration"><a href="SurfNPerfRT.html#.SNPRTProto.duration">SNPRTProto.duration</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getBlockingTime"><a href="SurfNPerfRT.html#.SNPRTProto.getBlockingTime">SNPRTProto.getBlockingTime</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getEnd"><a href="SurfNPerfRT.html#.SNPRTProto.getEnd">SNPRTProto.getEnd</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getFullRequestLoadTime"><a href="SurfNPerfRT.html#.SNPRTProto.getFullRequestLoadTime">SNPRTProto.getFullRequestLoadTime</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getLastResource"><a href="SurfNPerfRT.html#.SNPRTProto.getLastResource">SNPRTProto.getLastResource</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getNetworkDuration"><a href="SurfNPerfRT.html#.SNPRTProto.getNetworkDuration">SNPRTProto.getNetworkDuration</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getNetworkTime"><a href="SurfNPerfRT.html#.SNPRTProto.getNetworkTime">SNPRTProto.getNetworkTime</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getOrigins"><a href="SurfNPerfRT.html#.SNPRTProto.getOrigins">SNPRTProto.getOrigins</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getResource"><a href="SurfNPerfRT.html#.SNPRTProto.getResource">SNPRTProto.getResource</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getResourceCount"><a href="SurfNPerfRT.html#.SNPRTProto.getResourceCount">SNPRTProto.getResourceCount</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getResourceNamesFromOrigin"><a href="SurfNPerfRT.html#.SNPRTProto.getResourceNamesFromOrigin">SNPRTProto.getResourceNamesFromOrigin</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getResources"><a href="SurfNPerfRT.html#.SNPRTProto.getResources">SNPRTProto.getResources</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getResourcesFromOrigin"><a href="SurfNPerfRT.html#.SNPRTProto.getResourcesFromOrigin">SNPRTProto.getResourcesFromOrigin</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getServerTime"><a href="SurfNPerfRT.html#.SNPRTProto.getServerTime">SNPRTProto.getServerTime</a></li>
            
                <li data-name="SurfNPerfRT.SNPRTProto.getStart"><a href="SurfNPerfRT.html#.SNPRTProto.getStart">SNPRTProto.getStart</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="index.html">Index</h1>
        


    


    <h3> </h3>








    




    <section>
        <article class="readme"><h1>Surf-N-Perf</h1>
<p>Micro-library for gathering frontend web page performance data.</p>
<p>Surf-N-Perf provides a simple to use API to gather <a target="_blank" href="http://www.w3.org/TR/user-timing/">User Timing</a> and other important performance data in any browser.</p>
<p>Tired of typing <code>window.performance.getEntriesByName('foo')[0].startTime;</code> with your User Timing Polyfill?</p>
<p>With Surf-N-Perf, all you need  is <code>surfnperf.getMark('foo')';</code>, and that's just the start!</p>
<p>Check out the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/wiki/JavaScript-API">JavaScript API</a> to see all of its features and the <a target="_blank" href="http://comcast.github.io/Surf-N-Perf/docs/SurfNPerf.html">full documentation</a> for a list of methods &amp; how to use them.</p>
<p>Available as an <a target="_blank" href="https://www.npmjs.com/package/surfnperf">NPM Module</a>, <a target="_blank" href="https://rubygems.org/gems/surfnperf">Ruby Gem</a>, and a <a target="_blank" href="https://bower.io/">Bower</a> package.</p>
<p><img src="https://github.com/Comcast/Surf-N-Perf/actions/workflows/test.yml/badge.svg" alt="Build Status"></p>
<h2>Usage</h2>
<h3>Including the code in your project</h3>
<p>There are 2 pieces of code that need to be included in your webpage:</p>
<p><strong>1.</strong> The following code must be included as high up in the source code of your base HTML document as possible, ideally right after the opening <code>&lt;head&gt;</code> tag:</p>
<pre class="prettyprint source lang-html"><code>&lt;script>
  var SURF_N_PERF = {
    marks: {},
    highResMarks: {}
  };

  SURF_N_PERF.marks.pageStart = (new Date()).getTime();

  if(window.performance) {
    if(window.performance.now) {
      SURF_N_PERF.highResMarks.pageStart = window.performance.now();
    }
    if(window.performance.mark) {
      window.performance.mark('pageStart');
    }
  }

  SURF_N_PERF.visibility = {
    initialState: document.visibilityState,
    stateUpdates: [],
    hiddenProperty: null,
    stateProperty: null,
    eventName: null,
    markChange: function() {
      var markName = 'visibility' + SURF_N_PERF.visibility.stateUpdates.length;

      if (window.performance) {
        if (window.performance.mark) {
          window.performance.mark(markName);
        }

        if (window.performance.now) {
          SURF_N_PERF.highResMarks[markName] = window.performance.now();
        }
      }

      SURF_N_PERF.marks[markName] = new Date().getTime();

      SURF_N_PERF.visibility.stateUpdates.push(document[SURF_N_PERF.visibility.stateProperty]);
    },
  };

  if('hidden' in document) {
    SURF_N_PERF.visibility.hiddenProperty = 'hidden';
    SURF_N_PERF.visibility.stateProperty = 'visibilityState';
    SURF_N_PERF.visibility.eventName = 'visibilitychange';
  } else if('webkitHidden' in document) {
    SURF_N_PERF.visibility.hiddenProperty = 'webkitHidden';
    SURF_N_PERF.visibility.stateProperty = 'webkitVisibilityState';
    SURF_N_PERF.visibility.eventName = 'webkitvisibilitychange';
    SURF_N_PERF.visibility.initialState = document[SURF_N_PERF.visibility.stateProperty];
  }

  SURF_N_PERF.setPageLoad = function() {
    SURF_N_PERF.marks.loadEventEnd = (new Date()).getTime();

    if(window.performance && window.performance.now) {
      SURF_N_PERF.highResMarks.loadEventEnd = window.performance.now();
    }
  };

  SURF_N_PERF.setFirstPaint = function() {
    SURF_N_PERF.marks.firstPaintFrame = (new Date()).getTime();

    if(window.performance && window.performance.now) {
      SURF_N_PERF.highResMarks.firstPaintFrame = window.performance.now();

      if(window.performance.mark) {
        window.performance.mark('firstPaintFrame');
      }
    }
  };

  if(window.addEventListener) {
    if (SURF_N_PERF.visibility.stateProperty) {
      document.addEventListener(SURF_N_PERF.visibility.eventName, SURF_N_PERF.visibility.markChange, false);
    }
    window.addEventListener('load', SURF_N_PERF.setPageLoad, false);
  } else {
    window.attachEvent('onload', SURF_N_PERF.setPageLoad);
  }
  if (window.requestAnimationFrame) {
    window.requestAnimationFrame(SURF_N_PERF.setFirstPaint);
  }
&lt;/script>
</code></pre>
<p>That provides support for the following:</p>
<ul>
<li>A <code>&quot;pageStart&quot;</code> mark for browsers that do not support <a target="_blank" href="http://www.w3.org/TR/navigation-timing/">Navigation Timing</a> which can be used to compute durations from when the page first started loading (specifically, this mark falls between the <a target="_blank" href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-domloading"><code>domLoading</code></a> and <a target="_blank" href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-dominteractive"><code>domInteractive</code></a> attributes of Navigation Timing)</li>
<li><code>&quot;pageStart&quot;</code> marks for browsers that support <a target="_blank" href="http://www.w3.org/TR/hr-time/">High Resolution Time</a> and/or <a target="_blank" href="http://www.w3.org/TR/user-timing/">User Timing</a> so that <code>&quot;pageStart&quot;</code> can be used as a consistent starting point for duration calculations across all browsers regardless of their supported features</li>
<li>A <code>&quot;loadEventEnd&quot;</code> mark for browsers that do not support <a target="_blank" href="http://www.w3.org/TR/navigation-timing/">Navigation Timing</a> which can be used to compute durations from when the load event of the document is completed (<a target="_blank" href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-loadend"><code>loadEventEnd</code></a>)</li>
<li>A <code>&quot;loadEventEnd&quot;</code> <a target="_blank" href="http://www.w3.org/TR/hr-time/#sec-DOMHighResTimeStamp">DOMHighResTimeStamp</a> mark for calculating high resolution durations between a Navigation Timing mark and a user mark in browsers that support <a target="_blank" href="http://www.w3.org/TR/hr-time/">High Resolution Time</a> but don't support <a target="_blank" href="http://www.w3.org/TR/user-timing/">User Timing</a></li>
<li>A <code>&quot;firstPaintFrame&quot;</code> mark (available in the best possible format for the browser, either a <a target="_blank" href="http://www.w3.org/TR/user-timing/#performancemark">User Timing Mark</a>, <a target="_blank" href="http://www.w3.org/TR/hr-time/#sec-DOMHighResTimeStamp">DOMHighResTimeStamp</a>, or <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/DOMTimeStamp">DOMTimeStamp</a>) that approximates the Time To First Paint in browsers that <a target="_blank" href="http://caniuse.com/#feat=requestanimationframe">support <code>window.requestAnimationFrame</code></a>.</li>
<li>The initial <code>visibilityState</code> as well as listeners for the <code>&quot;visibilitychange&quot;</code> event, enabling the ability to calculate how much time the page was hidden when you call <code>surfnperf.getHiddenTime()</code>. This is of particular importance as <a target="_blank" href="https://developers.google.com/web/updates/2017/03/background_tabs">Chrome as of version 57</a> and <a target="_blank" href="https://blog.mozilla.org/blog/2017/09/26/firefox-quantum-beta-developer-edition/">Firefox as of version 57</a> limit the resources assigned to background (hidden) tabs.</li>
</ul>
<p><strong>2.</strong> Then just drop the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/surfnperf.min.js">surfnperf.min.js</a> in your codebase and reference that JavaScript file in your HTML document. If you're using <a target="_blank" href="http://requirejs.org/">RequireJS</a> or <a target="_blank" href="http://browserify.org/">Browserify</a>, it registers itself as 'surfnperf'.</p>
<p><strong>3.</strong> (Optional) If you would like access to the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API">Resource Timing</a> helper functions, include <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/resource-timing.js">resource-timing.js</a> in your codebase and reference that JavaScript file in your HTML document. If you're using <a target="_blank" href="http://requirejs.org/">RequireJS</a>, it registers itself as 'surfnperf/resource-timing', otherwise it is available on <code>window</code> as <code>window.surfnperfRT</code>.</p>
<h3>Storing &amp; Retrieving Performance Data</h3>
<p>Details in the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/wiki/JavaScript-API">JavaScript API</a> page in the wiki</p>
<h3>Resource Timing Helper Functions</h3>
<p>Documented in the <a target="_blank" href="http://comcast.github.io/Surf-N-Perf/docs/SurfNPerfRT.html">JSDoc-generated Documentation</a></p>
<h2>Ruby Project Integration</h2>
<h3>Using within a Rails project</h3>
<p>The <a target="_blank" href="https://rubygems.org/gems/surfnperf">surfnperf Ruby Gem</a> allows you to quickly &amp; easily integrate Surf-N-Perf into your <a target="_blank" href="http://rubyonrails.org/">Rails</a> projects. To include the necessary files, add <code>surfnperf</code> to your <code>Gemfile</code>:</p>
<pre class="prettyprint source lang-ruby"><code>gem 'surfnperf'
</code></pre>
<p>After a <code>$ bundle install</code>, you'll be able to include the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/surfnperf.js">main JavaScript file</a> in your JavaScript manifest by simply adding:</p>
<pre class="prettyprint source"><code>//= require surfnperf
</code></pre>
<p>The necessary script for the <code>&lt;head&gt;</code> of your HTML document is also available to you via a <a target="_blank" href="http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials">partial template</a> that you can include in the appropriate layout file for your page, such as <code>app/views/layouts/application.html.erb</code> by simply adding this line:</p>
<pre class="prettyprint source lang-erb"><code>&lt;%= render &quot;surfnperf/head&quot; %>
</code></pre>
<p>Those 3 lines of code are all your need to get started using Surf-N-Perf in Rails!</p>
<h3>Using within a Middleman project</h3>
<p>The <a target="_blank" href="https://rubygems.org/gems/surfnperf">surfnperf Ruby Gem</a> also allows you to quickly &amp; easily integrate Surf-N-Perf into your <a target="_blank" href="https://middlemanapp.com/">Middleman</a> projects. Instructions are similar to the Rails instructions above, with one extra step. Start by adding at least v1.1.0 of <code>surfnperf</code> to your Middleman project's <code>Gemfile</code>:</p>
<pre class="prettyprint source lang-ruby"><code>gem &quot;surfnperf&quot;, &quot;>=1.1.0&quot;
</code></pre>
<p>After a <code>$ bundle install</code>, you'll be able to include the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/surfnperf.js">main JavaScript file</a> in your JavaScript manifest by simply adding:</p>
<pre class="prettyprint source"><code>//= require surfnperf
</code></pre>
<p>The necessary script for the <code>&lt;head&gt;</code> of your HTML document is also available to you via a <a target="_blank" href="https://middlemanapp.com/basics/helper_methods/#custom-defined-helpers">custom defined helper</a> that you can include in the appropriate layout file for your page, such as <code>source/layouts/layout.erb</code> by adding this line:</p>
<pre class="prettyprint source lang-erb"><code>&lt;%= surfnperf_head %>
</code></pre>
<p>You will also have to configure the extension for that helper to be recognized by Middleman by adding this line to your <code>config.rb</code>:</p>
<pre class="prettyprint source lang-ruby"><code>activate :surfnperf
</code></pre>
<p>You'll want to do that <strong>outside</strong> of your build-specific configuration (i.e. outside the <code>configure :build do</code> block) so that it is available when you run <code>$ bundle exec middleman server</code></p>
<p>Those 4 lines of code are all your need to get started using Surf-N-Perf in Middleman!</p>
<h3>Using within other Ruby projects that integrate with Sprockets</h3>
<p><a target="_blank" href="https://github.com/sstephenson/sprockets">Sprockets</a> is what powers the <a target="_blank" href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipeline</a> in Rails, Middleman, and other Ruby website tools. For these other Ruby projects that use <a target="_blank" href="https://middlemanapp.com/advanced/asset_pipeline/">Sprockets</a>, integration is similar to the Rails instructions above, with one extra step:</p>
<p>Add <code>surfnperf</code> to your <code>Gemfile</code>:</p>
<pre class="prettyprint source lang-ruby"><code>gem 'surfnperf'
</code></pre>
<p>After a <code>$ bundle install</code>, include <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/surfnperf.js">surfnperf.js</a> in your JavaScript manifest by adding:</p>
<pre class="prettyprint source"><code>//= require surfnperf
</code></pre>
<p>For now, you'll have to manually include the <a href="#including-the-code-in-your-project">necessary script</a> for the <code>&lt;head&gt;</code> of your HTML document.</p>
<h2>Running Tests &amp; Other Development Tools</h2>
<p>Tests are written in <a target="_blank" href="http://jasmine.github.io/">Jasmine</a> and run with <a target="_blank" href="http://karma-runner.github.io/">Karma</a></p>
<p>Install the dependencies by executing this command from the root of your Surf-N-Perf project directory:</p>
<pre class="prettyprint source lang-bash"><code>$ npm install
</code></pre>
<p>If Grunt CLI has not been already installed, <a target="_blank" href="http://gruntjs.com/getting-started">go install it</a>.</p>
<p>And then run the tests, JSHint, beautify your code &amp; generate the minified file with:</p>
<pre class="prettyprint source lang-bash"><code>$ grunt dev
</code></pre>
<p>By default, it will run the tests using <a target="_blank" href="http://phantomjs.org/">PhantomJS</a>. You can also run the tests in any browser by going to http://localhost:9876/</p>
<p>The <code>grunt dev</code> process will watch for file updates, so as you modify surfnperf.js or the test files, it will automatically run jshint, jsbeautifier, uglify &amp; the tests. To stop the watch process, press control + C</p>
<h2>License</h2>
<p>Licensed under the <a target="_blank" href="https://github.com/Comcast/Surf-N-Perf/blob/main/LICENSE">MIT License</a></p></article>
    </section>






        

        <footer>
            Documentation generated by <a target="_blank" href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Fri Oct 07 2022 20:48:17 GMT+0000 (Coordinated Universal Time)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/jaguar.js"></script>
</body>
</html>